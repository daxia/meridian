---
# 本文档为 Agent 强约束策略，与 .cursor/rules/docs-agents_v1.md 配套使用
policy_id: doc-review-gate
version: 1
created: 2026-02-09
updated: 2026-02-09
---

# 文档审核门控策略（从需求到实现）

> **约束对象**：所有在 docs/ 下按「需求 → PRD → 设计 → 实现」流程产出的文档与代码。  
> **核心原则**：**上一阶段文档未审核通过（status = approved），禁止撰写下一阶段文档或进入实现。**

---

## 1. 流程阶段与文档顺序

| 顺序 | 阶段       | 目录           | 产出文档示例           | 审核通过后允许 |
|------|------------|----------------|------------------------|----------------|
| 1    | 我的需求   | 01-我的需求    | 我的需求.md（单文档，每条带状态） | 撰写 02 PRD    |
| 2    | PRD        | 02-产品需求文档PRD | PRD-XXX-YYYYMMDD.md   | 撰写 04 设计   |
| 3    | 设计       | 04-设计文档    | DD-XXX-YYYYMMDD.md    | 进入代码实现   |
| 4    | 实现       | —              | 代码修改               | 撰写 06 开发记录等 |

- **需求（01）**：单一文档 **我的需求.md**，用户按条追加原始需求；每条需求须带**状态**（待实现、进行中、已完成、废弃、未来实现），按状态决定是否可写 PRD、是否在实现中。审核与疑问在 **02 PRD 内**完成，不在此文档填写。仅当该条状态为**待实现**且用户已指示可撰写 PRD 时，Agent 才可撰写 **02 PRD**；撰写后将该条改为「进行中」，实现验收后改为「已完成」。
- **PRD（02）**：产品需求文档，目标与验收标准。完成后进入 **review**，**approved** 后 Agent 才可撰写 **04 设计文档**。
- **设计（04）**：设计文档（含修改计划、接口与影响）。完成后进入 **review**，**approved** 后 Agent 才可进行 **代码实现**。
- **实现**：按设计修改代码；实现完成后可撰写 06 开发记录、05 经验手册（fixbug 时）、09 重构记录等。

---

## 2. 审核门控规则（Agent 必须遵守）

1. **从 01 开始**：新需求必须先在 **01-我的需求** 的 **我的需求.md** 中追加一条并标注状态，不得跳过需求直接写 PRD 或设计。
2. **一阶段一文档**：同一需求链上，01 → 02 → 04 各阶段至少有一份对应文档，且 **上一阶段文档 status 为 approved 后，才可创建或大幅修改下一阶段文档**。
3. **状态机**：每份文档的 status 遵循 `draft → review → approved`。只有 **approved** 的文档才能作为「写下一文档」或「写代码」的依据。01 中每条需求的状态（待实现/进行中/已完成/废弃/未来实现）决定是否可写 PRD、是否在实现中。
4. **禁止跳步**：01 中该条需求状态非「待实现」且未获用户指示时，禁止写 02 PRD；未存在已 approved 的 02 PRD 时，禁止写 04 设计；未存在已 approved 的 04 设计时，禁止改代码。
5. **审核动作**：文档撰写或修改完成后，由人工或授权流程将 status 从 `draft` 改为 `review`，审核通过后改为 `approved`。Agent 不得自行将文档标为 `approved`，除非用户明确指令「批准」「通过」「approved」。

---

## 3. 门控检查表（Agent 执行前自检）

在撰写下一阶段文档或动手改代码前，Agent 必须确认：

| 拟执行动作         | 必须满足的条件                                                                 |
|--------------------|--------------------------------------------------------------------------------|
| 撰写 02 PRD        | 01 我的需求.md 中已有该条需求描述，该条状态为「待实现」（或已改为待实现），且用户已指示可为该条撰写 PRD |
| 撰写 04 设计文档  | 存在对应主题的 02 PRD，且其 status = approved                                 |
| 进行代码实现       | 存在对应主题的 04 设计文档，且其 status = approved                            |

若不满足，Agent 必须拒绝执行并提示：「请先完成上一阶段文档并审核通过（status = approved）。」

---

## 4. 与 docs-agents_v1 的关系

- 本策略与 **.cursor/rules/docs-agents_v1.md** 中的「文档状态机」「最小执行闭环」一致，是对「**审核通过后再写下一个文档**」的显式细化。
- AGENTS.md 与 docs-agents_v1.md 中均引用本策略：文档流从 **01-我的需求** 开始，**步步审核、通过后才允许写下一文档或实现**。
