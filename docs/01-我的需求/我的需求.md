---
doc_type: requirement

doc_id: 我的需求

status: active

owner: user

created: 2026-02-14

updated: 2026-02-14
---
# 我的需求

本文档为需求方（用户）填写的**原始需求**唯一集合。每条需求带**状态**，用于驱动是否写 PRD、是否实现。审核与疑问在 02-PRD 中完成，不在此文档填写。

## 状态说明

| 状态     | 含义                 | 使用方式                                          |

| -------- | -------------------- | ------------------------------------------------- |

| 待实现   | 已写入，待排期       | 可为此条撰写 PRD；写 PRD 后可将本条改为「进行中」 |

| 进行中   | 已进入 PRD/设计/实现 | 对应 PRD 或设计已存在；实现完成后改为「已完成」   |

| 已完成   | 已验收上线           | 仅记录，不再排期                                  |

| 废弃     | 不再做               | 不写 PRD、不实现                                  |

| 未来实现 | 暂不排期             | 需要时改为「待实现」再排期                        |

## 条目约定

- 每条需求一节：`## 需求N. 需求标题（可选日期）`
- 必须标注**编号**（YYYYMMDD001 格式，唯一识别码）、**状态**与可选**关联 PRD**、可选**关联 DD**
- 内容：需求描述、目标、范围等**原始表述**；审核与疑问在 02-PRD 中完成。
- 需写 PRD 时，请明确说「为第 N 条需求写 PRD」或「为【需求标题】写 PRD」。

---

## 需求1. Admin Panel 数据显示修复 (2026-02-14)

**编号**：20260214001

**状态**：进行中

**关联 PRD**：PRD-WEB-API-Admin页面数据修复-20260214

**关联 DD**：DD-WEB-API-Admin页面数据修复-20260214

### 1.1 用户原始需求内容

Admin Panel 的 "Source Analytics" 列表中存在多处数据显示异常（参考截图 `1771031206303.png`）：

1.**日期显示错误**: "LAST CHECKED" 列显示为 `NaN-NaN-NaN NaN:NaN:NaN`。

2.**数据计算错误**: "ERROR RATE" 和 "SUCCESS RATE" 列显示为 `N/A%`。

3.**源名称丢失**: 部分 Source 名称显示为 `Unknown`。

4.**平均值错误**: "AVG/DAY" 显示为 `N/A`。

**预期**:

1. 日期应正确格式化，若无日期则显示 "Never" 或 "-"。
2. 百分比在无数据时应显示 "0%" 或 "-"。
3. Source 名称应正确从后端获取并显示。

### 1.2 Agent 整理后需求内容

-**范围**: 前端 Admin 页面 (`apps/frontend`) 及后端统计接口 (`apps/backend`)。

-**关键点**:

- 前端日期格式化逻辑需处理 `null`/`undefined`。
- 前端百分比计算需处理除以零的情况。
- 后端需确保返回 Source Name，前端需确保正确绑定。

---

## 需求2. 日志文件 ANSI 颜色代码清理 (2026-02-14)

**编号**：20260214002

**状态**：已完成

**关联 PRD**：PRD-SYS-日志功能需求

**关联 DD**：DD-SYS-日志功能需求

### 2.1 用户原始需求内容

`logs/frontend.log` (以及其他服务日志) 包含大量 ANSI 颜色代码（如 `[90m`, `[32m`），导致在文本编辑器中查看困难。需要将这些代码从日志文件中移除，但保留在终端输出中。

### 2.2 Agent 整理后需求内容

-**范围**: 系统基础设施 (`start_all.js`)。

-**关键点**:

- 在写入日志文件前剥离 ANSI 转义序列。
- 保持控制台输出的颜色高亮。
- 适用于所有通过 `start_all.js` 启动的服务（Frontend, Backend, ML）。

---

## 需求3. 日志文件轮转与监控增强 (2026-02-14)

**编号**：20260214003

**状态**：待实现

**关联 PRD**：PRD-SYS-日志功能需求

**关联 DD**：DD-SYS-日志功能需求

### 3.1 用户原始需求内容

1.**Log文件**: 新增一个日期的后缀，每次启动应用时，新建新的log。

2.**后台运行**: 新增源，抓取数据，解析动作，也需要使用日志进行记录（如果已有则不加）。

3.**新增Log**: 每隔1分钟，记录一次列表中各个源还剩下多长时间进行下一次的抓取。

### 3.2 Agent 整理后需求内容

-**范围**: 系统基础设施 (`start_all.js`) 与 后端服务 (`apps/backend`)。

-**子需求拆解**:

  1.**日志轮转 (Log Rotation)**:

    - 修改`start_all.js`，启动时生成的日志文件名需带时间戳（如 `backend-2026-02-14-10-30-00.log`）。

    - 确保每次启动都创建新文件，而非追加。

  2.**操作日志 (Action Logs)**:

    -*分析结论*: 现有系统 (`DataSourceIngestorDO`, `Workflow`) 已具备详细的 Fetch/Parse 日志。**无需新增开发**，仅需验证。

  3.**源状态监控 (Source Status Monitor)**:

    - 在 Backend 实现定时任务 (Cron)。

    - 每分钟遍历数据库中的活跃源。

    - 计算并打印每个源距离下次抓取的倒计时。

---

## 需求4. 日志记录中文化 (2026-02-14)

**编号**：20260214004

**状态**：已完成

**关联 PRD**：PRD-SYS-日志功能需求

**关联 DD**：DD-SYS-日志功能需求

### 4.1 用户原始需求内容

当前日志记录（Log Module）均为英文，需要修改为中文，以符合开发习惯。需按照模板修改并走标准开发流程。

### 4.2 Agent 整理后需求内容

-**范围**: 系统基础设施 (`start_all.js`) 与 后端服务 (`apps/backend`)。

-**关键点**:

  -**启动日志**: `start_all.js` 中的进程启动、停止、构建提示信息需汉化。

  -**监控日志**: 新增的源状态监控日志 (`[SourceMonitor]`) 需使用中文。

  -**核心业务日志**: 关键流程（如抓取、解析）的日志建议汉化（视工作量逐步推进）。

---

## 需求5. Admin Panel 抓取时间列增强 (2026-02-14)

**编号**：20260214005

**状态**：已完成

**关联 PRD**：PRD-WEB-Admin页面需求

**关联 DD**：DD-WEB-Admin页面需求

### 5.1 用户原始需求内容

admin页面需求，新增2列，上一次的fetch时间，和下一次的执行时间，这样我就能知道上一次和下一次的执行情况，按照模板更新，按照开发流程走。

### 5.2 Agent 整理后需求内容

-**范围**: 前端 Admin 页面 (`apps/frontend`) 及后端统计接口 (`apps/backend`)。

-**关键点**:

- 在 Source Analytics 表格中新增 "Last Fetch" (上一次抓取时间) 和 "Next Fetch" (下一次抓取时间) 两列。
- 现有 "LAST CHECKED" 列可能与 "Last Fetch" 含义重复，需明确定义或替换。
- 后端需计算 `next_fetch_at` 字段并返回给前端。
- 前端需进行友好的时间格式化（如 Relative Time 或 `YYYY-MM-DD HH:mm`）。

---

## 需求6. Admin Panel 数据源调度初始化 (2026-02-14)

**编号**：20260214006

**状态**：待实现

**关联 PRD**：PRD-WEB-Admin页面需求

**关联 DD**：DD-WEB-Admin页面需求

### 6.1 用户原始需求内容

根据 `REQ-WEB-Fetch失效分析报告-20260214.md`，目前存在数据源已添加到数据库但 Durable Object 未初始化导致抓取任务未执行的问题。需要在 Admin 面板新增功能来解决此问题，手动初始化调度器。

### 6.2 Agent 整理后需求内容

-**范围**: 前端 Admin 页面 (`apps/frontend`) 及后端管理接口 (`apps/backend`)。

-**关键点**:

- 在 Admin 页面（Source Analytics 表格上方或操作栏）新增按钮 "初始化所有调度器" (Initialize All Schedulers)。
- 点击按钮后调用后端 `/admin/initialize-dos` 接口。
- 显示操作成功或失败的提示。
- 解决因 DO 未唤醒导致的 "Next Fetch" 时间已过但不执行的问题。

---

## 需求7. 情报汇总自动化流程 (2026-02-14)

**编号**：20260214007

**状态**：已完成

**关联 PRD**：PRD-API-核心服务需求

**关联 DD**：DD-API-核心服务需求

### 7.1 用户原始需求内容

源的文章获取了，为什么没有进行情报汇总，分析这个逻辑有没有执行，没看到相关的日志。

### 7.2 Agent 整理后需求内容

-**范围**: 后端服务 (`apps/backend`)、ML 服务 (`services/meridian-ml-service`)。

-**关键点**:

  -**自动触发**: 新增定时任务 (Cron)，定期（如每 6 小时）检查并触发汇总生成。

  -**工作流**: 新增 `GenerateBriefWorkflow`，负责从 DB 拉取未汇总文章、调用聚类/总结服务、生成报告。

  -**聚类服务**: 在 ML Service 或 Backend 实现文章聚类逻辑。

  -**报告存储**: 生成的 Report 需存入数据库 `reports` 表。

---

## 需求8. 日志归档与历史管理 (2026-02-14)

**编号**：20260214008

**状态**：已完成

**关联 PRD**：PRD-SYS-日志功能需求

**关联 DD**：DD-SYS-日志功能需求

### 8.1 用户原始需求内容

log日志记录，每次新建文件时，需要将旧的日志文件，移动到log文件同目录的history文件夹中。

### 8.2 Agent 整理后需求内容

-**范围**: 系统基础设施 (`start_all.js`)。

-**关键点**:

  -**启动清理**: 在应用启动生成新日志文件之前，执行归档操作。

  -**目录结构**: 在 `logs/` 下创建 `history/` 子目录。

  -**移动逻辑**: 将 `logs/` 根目录下现存的所有 `.log` 文件移动至 `logs/history/`。

  -**目的**: 保持 `logs/` 目录整洁，仅包含本次运行的日志，同时保留历史记录。

---

## 需求9. 日志流优化与时间戳注入 (2026-02-14)

**编号**：20260214009
**状态**：已完成
**关联 PRD**：PRD-SYS-日志功能需求
**关联 DD**：DD-SYS-日志功能需求

### 9.1 用户原始需求内容

优化日志系统，确保所有服务（包括 Python 子进程）的输出都能被捕获并准确注入时间戳。解决日志丢失或顺序错乱问题。

### 9.2 Agent 整理后需求内容

- **范围**: 系统基础设施 (`start_all.js`).
- **功能**:
  - 实现按行 Buffer 处理日志流。
  - 捕获 Python 服务 StdErr 输出。

---

## 需求10. ML Service 日志格式优化 (2026-02-14)

**编号**：20260214010
**状态**：待实现
**关联 PRD**：PRD-SYS-日志功能需求
**关联 DD**：DD-SYS-日志功能需求

### 10.1 用户原始需求内容

`ML Service` 的日志文件中包含 JSON 格式的日志行，如：
`[2026-02-14 13:04:20] {"timestamp": "...", "level": "info", "message": "42 changes detected", ...}`

需要将这些 JSON 日志解析并转换为标准的文本格式，使其与其他服务的日志风格保持一致。按照标准日志打印，并遵循开发流程。

### 10.2 Agent 整理后需求内容

- **范围**: 系统基础设施 (`start_all.js`).
- **关键点**:
  - **JSON 检测与解析**: 在 `start_all.js` 的日志处理流中，检测每行日志是否为 JSON 格式。
  - **格式化**: 如果是 JSON 且包含 `level` 和 `message` 字段，将其转换为标准格式 `[LEVEL] Message`。
  - **保留时间戳**: 使用 `start_all.js` 统一注入的外部时间戳，忽略或参考内部 JSON 时间戳（为保持一致性，建议使用外部注入的时间戳）。
  - **目标格式**: `[YYYY-MM-DD HH:mm:ss] [INFO] 42 changes detected`。

---

## 需求11. Admin 手动触发情报汇总 (2026-02-14)

**编号**：20260214011
**状态**：已实现
**关联 PRD**：PRD-WEB-Admin页面需求
**关联 DD**：DD-WEB-Admin页面需求

### 11.1 用户原始需求内容

在 Admin 页面新增一个按钮，用于手动触发智能情报汇总。

### 11.2 Agent 整理后需求内容

- **范围**: Frontend (Admin UI) + Backend.
- **功能**:
  - 后端：新增 `/briefs/trigger` 接口触发 `GenerateBriefWorkflow`。
  - 前端：新增 "Generate Briefing" 按钮。

---

## 需求12. Admin 页面汉化 (2026-02-14)

**编号**：20260214012
**状态**：待实现
**关联 PRD**：PRD-WEB-Admin页面需求
**关联 DD**：DD-WEB-Admin页面需求

### 12.1 用户原始需求内容

Admin 页面显示的英文标签，转成显示中文，按照需求开发流程来。

### 12.2 Agent 整理后需求内容

- **范围**: Frontend (Admin UI).
- **功能**:
  - 将 Admin 页面上的所有英文静态文本替换为中文。
  - 涉及区域：
    - 顶部标题栏 (Admin Panel)
    - 操作按钮 (Generate Briefing, Initialize Schedulers, Add Source, Reprocess Articles)
    - 概览卡片 (System Overview, Last Activity, Today's Stats, Source Health)
    - 统计卡片 (Avg Process Success, Avg Error Rate, Avg Articles/Day)
    - 筛选栏 (Frequency, Paywall only, Show errors only, etc.)
    - 表格列头 (SOURCE, FREQUENCY, LAST CHECKED, etc.)
- **目标**: 提升中文用户体验。

---

## 需求13. 情报简报本地导出 (2026-02-14)

**编号**：20260214013
**状态**：已完成
**关联 PRD**：PRD-SYS-报告导出.md
**关联 DD**：DD-SYS-报告导出.md

### 13.1 用户原始需求内容

将生成的情报简报同时输出到 `report` 目录中。
文件名格式：`情报简报-YYYYMMDD.md`。
注：用户提及“使用pdf格式”，但文件名示例后缀为 `.md`。

### 13.2 Agent 整理后需求内容

- **范围**: 系统工具 / 本地脚本。
- **背景**: Backend 运行在 Cloudflare Workers 环境，无法直接写入宿主机文件系统。
- **方案**:
  - 创建本地监听脚本或定时任务（可集成至 `start_all.js` 或独立脚本）。
  - 定期轮询 Backend 的简报接口，获取最新简报。
  - 将内容写入项目根目录下的 `report/` 文件夹。
  - **格式**: 优先实现 Markdown (`.md`) 导出。若需 PDF，可引入 `md-to-pdf` 等工具在本地转换。

---

## 需求14. 简报生成失败诊断与修复 (2026-02-14)

**编号**：20260214014

**状态**：进行中

**关联 PRD**：PRD-API-核心服务需求

**关联 DD**：DD-API-简报生成诊断与修复-20260214

### 14.1 用户原始需求内容

在 Admin 界面点击"生成情报简报"时，系统返回日志：
```
Starting Intelligence Brief Generation
No articles found in the last 24 hours.
```
简报生成工作流（GenerateBriefWorkflow）无法找到符合条件的文章，导致无法生成每日简报。

### 14.2 Agent 整理后需求内容

- **范围**: Backend (`apps/backend`)、ML Service (`services/meridian-ml-service`)。
- **问题分析**:
  - `GenerateBriefWorkflow` 查询条件：`status = 'PROCESSED'` 且 `embedding IS NOT NULL` 且 `processed_at >= 24小时前`
  - 可能原因：
    1. 数据库中没有新文章被成功处理
    2. 文章状态停留在 `NEW`、`FAILED_*` 等状态
    3. Embedding 生成失败或未正确保存
    4. `processed_at` 时间戳未正确更新
- **关键点**:
  - 诊断当前数据库中文章的状态分布
  - 检查 RSS 抓取是否正常工作
  - 验证 ML Service 可用性
  - 修复发现的问题，确保简报生成流程完整可用
